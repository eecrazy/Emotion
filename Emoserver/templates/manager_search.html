{% extends "base_manage.html" %}
{% load upload_tags %}


{%block title%} search by author or tag {% endblock %}

{%block css_script %}
<link href="{{ STATIC_URL }}css/jquery.tagsinput.css" rel="stylesheet">

<style type="text/css">

    .search_box {
      clear: both;
      margin-top: 20px;
      margin-right: 20px;
      margin-bottom: 20px;
      width:100%; 
    }
    .imgbox {
        background-color: #ffffff;
        padding: 10px;
        margin-bottom: 10px;
        -webkit-box-shadow: 0 8px 6px -6px #999;
        -moz-box-shadow: 0 8px 6px -6px #999;
        box-shadow: 0 8px 6px -6px #999;
    }
    .imgtags {
        border-top: 1px solid #dadada;
        padding-top: 5px;
    }
    .populraity_tag {
        float: right;
        font-size: 40px;

    }

</style>

<script src="{{ STATIC_URL }}js/jquery.tagsinput.js"></script> 
{% endblock %}


{% block display %}
    <div class="col-md-3 column search_box">
    

    <div class = "search">
       <form action="/search/author" method="GET" class = "search-form">
           <input type="text" name="author">
           <input type="submit" value="按作者搜索">
       </form>
   </div>    
   <div class = "search">
       <form action="/search/tag" method="get" class = "search-form">
           <input type="text" name="tag">
           <input type="submit" value="按标签搜索">
       </form>
   </div>    
    </div>

    {% if object_list %}
        {% for emo in object_list %} 
            {% if emo.emo_img %}
            <div class="col-md-3 column imgbox">
                <img width="190px" height="200px" src="{{emo.emo_img.url}}" />

                <div class="imgtags">
                <input class="form-control tag_form" pk="{{emo.pk}}" value="{{ emo.emo_init_tag_list|joinby:'tag_name'}}">
                </div>
            {% if flag %}
                <div class="popularity_tag" style="margin-top:12px;font-size:13px;">
                <span>作者:  {{ user_object.username}}</span>
                </div>
            {% endif %} 
            {% if not flag %}
                <div class="popularity_tag" style="margin-top:12px;font-size:13px;">
                <span>作者:  {{ user_list.username}}</span>
                </div>
              
            {% endif %} 
                <div class="popularity_tag" style="margin-top:12px;font-size:13px;float:left;">
                <span>流行度:  {{ emo.emo_popularity}}</span>
                </div>

                <div class="pull-right" style="margin-top:5px;">
                <a href="/upload/delete/{{emo.pk}}" class="btn btn-danger btn-sm">
                <i class="glyphicon glyphicon-trash"></i>
                <span>删除</span>
                </a>
                </div>

            </div>
            {% endif %} 
        {% endfor%} 
    {% endif %}


<!--    {% if is_paginated %}
        <div class="pagination pull-right">
            <span class="page-links">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                {% endif %}
                <span class="page-current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">next</a>
                {% endif %}
            </span>
        </div>

    {% endif %}

-->

<script type="text/javascript">

    $(function() {
        var regx = /^[a-zA-Z|\d|\u0391-\uFFE5]{0,10}$/
        $(".tag_form").tagsInput({

            "onAddTag": function(tag) {
                if (!regx.test(tag)){
                    alert("标签只能为字母数字汉字,不超过十个字");
                    return;
                }
                focused_input = $("input:focus").attr("id").slice(0, -4);
                pk = $("#" + focused_input).attr("pk");

                $.getJSON("/addtag", {
                    "pk": pk,
                    "tag": tag
                }, function(data) {
                    console.log(data)
                });
            },
            "onRemoveTag": function(tag) {

                $(".tagsinput").hover(function(e){
                    hover_input = e.currentTarget.id.slice(0,-10)
                    pk = $("#" + hover_input).attr("pk");

                    $.getJSON("/removetag", {
                        "pk": pk,
                        "tag": tag
                    }, function(data) {
                        console.log(data)
                    });
                    $(".tagsinput").unbind('mouseenter mouseleave');
                });
                }

        });
    });
</script>

{% endblock %}
