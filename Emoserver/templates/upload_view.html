{% extends "base_manage.html" %}
{% load upload_tags %}


{%block title%} diplay {% endblock %}

{%block css_script %}
<link href="{{ STATIC_URL }}css/jquery.tagsinput.css" rel="stylesheet">

<style type="text/css">
    .imgbox {
        background-color: #ffffff;
        padding: 10px;
        margin-bottom: 10px;
        -webkit-box-shadow: 0 8px 6px -6px #999;
        -moz-box-shadow: 0 8px 6px -6px #999;
        box-shadow: 0 8px 6px -6px #999;
    }
    .imgtags {
        border-top: 1px solid #dadada;
        padding-top: 5px;
    }
    .populraity_tag {
        float: right;
        font-size: 40px;

    }

</style>

<script src="{{ STATIC_URL }}js/jquery.tagsinput.js"></script> 
{% endblock %}


{% block display %}
    {% if object_list %}
        {% for emo in object_list %} 
            {% if emo.emo_img %}
            <div class="col-md-3 column imgbox">
                <img width="200px" height="200px" src="{{emo.emo_img.url}}" class="img-responsive" />

                <div class="imgtags">
                <input class="form-control tag_form" pk="{{emo.pk}}" value="{{ emo.emo_init_tag_list|joinby:'tag_name'}}">
                </div>

                <div class="popularity_tag" style="margin-top:12px;font-size:13px;float:left;">
                <span>流行度:  {{ emo.emo_popularity}}</span>
                </div>

                <div class="pull-right" style="margin-top:5px;">
                <a href="/upload/delete/{{emo.pk}}" class="btn btn-danger btn-sm">
                <i class="glyphicon glyphicon-trash"></i>
                <span>删除</span>
                </a>
                </div>

            </div>
            {% endif %} 
        {% endfor%} 
    {% endif %}


<!--    {% if is_paginated %}
        <div class="pagination pull-right">
            <span class="page-links">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                {% endif %}
                <span class="page-current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">next</a>
                {% endif %}
            </span>
        </div>

    {% endif %}

-->
<script type="text/javascript">
    $(function() {
        var regx = /^[a-zA-Z|\d|\u0391-\uFFE5]{0,10}$/
        $(".tag_form").tagsInput({

            "onAddTag": function(tag) {
                if (!regx.test(tag)){
                    alert("标签只能为字母数字汉字,不超过十个字");
                    return;
                }
                focused_input = $("input:focus").attr("id").slice(0, -4);
                pk = $("#" + focused_input).attr("pk");
                $.getJSON("/addtag", {
                    "pk": pk,
                    "tag": tag
                }, function(data) {
                    console.log(data)
                });
            },
            "onRemoveTag": function(tag) {

                $(".tagsinput").hover(function(e){
                    hover_input = e.currentTarget.id.slice(0,-10)
                    pk = $("#" + hover_input).attr("pk");

                    $.getJSON("/removetag", {
                        "pk": pk,
                        "tag": tag
                    }, function(data) {
                        console.log(data)
                    });
                    $(".tagsinput").unbind('mouseenter mouseleave');
                });
                }

        });


    });
</script>
{% endblock %}
